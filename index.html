<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <title>Find4U - 拽专转 爪专</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <!-- 住 转 专 -->
  <div id="header-placeholder"></div>

  <!-- 转 专 砖 祝 -->
  <main>
    <p class="welcome-text"> 专  -Find4U </p>
    <p class="subtitle"> 爪 注专 转 爪专 砖 转专 专 砖拽 转</p>

    <div class="social-links"></div>

    <p class="subtitle search-text">驻砖 爪专:</p>
    <div class="search-container">
      <input id="searchInput" type="text" placeholder="驻砖 爪专..." dir="rtl" autocomplete="off" />
      <ul id="autocomplete-list" class="autocomplete-list"></ul>
    </div>

    <div id="productsGrid" class="grid-container"></div>
  </main>

  <!-- 住驻专转 住驻转 -->
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script src="products.js"></script>
  <script src="script.js"></script>

  <!-- 住拽专驻   砖  转 专  转 Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD6o0oDX5ahIw-7E0tUy76ImJDCFWbv4x8",
      authDomain: "find4u-il.firebaseapp.com",
      projectId: "find4u-il",
      storageBucket: "find4u-il.appspot.com",
      messagingSenderId: "1063243167726",
      appId: "1:1063243167726:web:16a8bbaf73ed8181e680ff",
      measurementId: "G-SYR49CZGZZ"
    };

    window.app = initializeApp(firebaseConfig);
    window.auth = getAuth(app);
    window.provider = new GoogleAuthProvider();
    window.signInWithPopup = signInWithPopup;
    window.signOut = signOut;
    window.onAuthStateChanged = onAuthStateChanged;

    // 注 HEADER  转 专注
    fetch('header.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('header-placeholder').innerHTML = data;
        initHeaderEvents();
      });

    function initHeaderEvents() {
      const menuToggle = document.querySelector('.menu-toggle');
      const navCategories = document.getElementById('categoryButtons');

      if (menuToggle && navCategories) {
        menuToggle.addEventListener('click', () => {
          navCategories.classList.toggle('show');
        });
      }

      const googleLoginBtn = document.getElementById("googleLoginBtn");
      const profileMenu = document.getElementById("profileMenu");
      const profileAvatar = document.getElementById("profileAvatar");
      const profileDropdown = document.getElementById("profileDropdown");
      const logoutBtn = document.getElementById("logoutBtn");

      googleLoginBtn.addEventListener("click", () => {
        signInWithPopup(window.auth, window.provider)
          .then((result) => {
            console.log("砖转砖 转专:", result.user);
          })
          .catch((error) => {
            console.error(error);
            alert("砖: " + error.message);
          });
      });

      logoutBtn.addEventListener("click", () => {
        signOut(window.auth)
          .then(() => {
            console.log("转转拽转");
          })
          .catch((error) => console.error(error));
      });

      onAuthStateChanged(window.auth, (user) => {
        if (user) {
          googleLoginBtn.style.display = "none";
          profileMenu.style.display = "inline-block";
          const displayName = user.displayName || "U";
          profileAvatar.textContent = displayName.charAt(0).toUpperCase();
        } else {
          googleLoginBtn.style.display = "flex";
          profileMenu.style.display = "none";
          profileDropdown.style.display = "none";
        }
      });

      profileAvatar.addEventListener("click", () => {
        profileDropdown.style.display =
          profileDropdown.style.display === "block" ? "none" : "block";
      });

      window.addEventListener("click", (e) => {
        if (!profileMenu.contains(e.target) && e.target.id !== "googleLoginBtn") {
          profileDropdown.style.display = "none";
        }
      });
    }
  </script>

</body>
</html>
